{% extends "base.html" %}
{% block title %}My Progress â€“ Language App{% endblock %}

{% block content %}
<div class="container">

  <a href="/feed" class="back-link">â† Back to feed</a>

  <div class="page-header">
    <h1 class="page-title">My Progress</h1>
    <p class="page-subtitle">Track your XP, streaks, and recent quiz results.</p>
  </div>

  <!-- Stats row -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-card__label">âš¡ Total XP</div>
      <div class="stat-card__val stat-card__val--accent">{{ total_xp }}</div>
      <div class="stat-card__sub">experience points earned</div>
    </div>

    <div class="stat-card">
      <div class="stat-card__label">ğŸ”¥ Current streak</div>
      {% if streak and streak.current_streak_days %}
        <div class="stat-card__val">{{ streak.current_streak_days }}<span style="font-size:1rem;font-weight:500;color:var(--text-muted);"> day{{ 's' if streak.current_streak_days != 1 else '' }}</span></div>
        {% if streak.last_active_date_utc %}
        <div class="stat-card__sub">Last active: {{ streak.last_active_date_utc }}</div>
        {% endif %}
      {% else %}
        <div class="stat-card__val" style="color:var(--text-subtle);">0</div>
        <div class="stat-card__sub">Complete a quiz to start your streak</div>
      {% endif %}
    </div>

    <div class="stat-card">
      <div class="stat-card__label">ğŸ“ Quizzes taken</div>
      <div class="stat-card__val">{{ enriched_attempts | length }}</div>
      <div class="stat-card__sub">total attempts</div>
    </div>
  </div>

  <!-- Recent attempts -->
  <div class="section-title">Recent attempts</div>

  {% if enriched_attempts %}
  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>Content</th>
          <th>Score</th>
          <th>XP awarded</th>
          <th>Date (UTC)</th>
        </tr>
      </thead>
      <tbody>
        {% for item in enriched_attempts %}
        <tr>
          <td>
            {% if item.content %}
              <a href="/content/{{ item.content.id }}/quiz">{{ item.content.title }}</a>
            {% else %}
              <span style="color:var(--text-subtle);">(deleted content)</span>
            {% endif %}
          </td>
          <td>
            <span style="color:var(--text);font-weight:600;">{{ item.attempt.score_percent }}%</span>
            <span style="color:var(--text-subtle);font-size:0.8125rem;margin-left:4px;">({{ item.attempt.correct_count }}/{{ item.attempt.total_questions }})</span>
          </td>
          <td>
            {% if item.attempt.xp_awarded > 0 %}
              <span class="chip chip-accent">+{{ item.attempt.xp_awarded }} XP</span>
            {% else %}
              <span style="color:var(--text-subtle);">â€”</span>
            {% endif %}
          </td>
          <td style="font-size:0.875rem;">{{ item.attempt.completed_at.strftime('%Y-%m-%d %H:%M') }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="empty-state">
    <div class="empty-state__icon">ğŸ“Š</div>
    <div class="empty-state__title">No attempts yet</div>
    <p id="no-attempts" class="empty-state__desc">
      Complete a quiz to see your progress here.
    </p>
    <a href="/feed" class="btn btn-primary">Go to feed â†’</a>
  </div>
  {% endif %}

</div>
{% endblock %}
