{% extends "base.html" %}
{% block title %}My Progress – Language App{% endblock %}
{% block content %}
<p><a href="/feed">← Back to feed</a></p>

<h1>My Progress</h1>

<table style="border-collapse:collapse; margin-bottom:1.5rem;">
  <tr>
    <td style="padding:0.3rem 1.2rem 0.3rem 0; color:#555;">Total XP</td>
    <td><strong>{{ total_xp }}</strong></td>
  </tr>
  <tr>
    <td style="padding:0.3rem 1.2rem 0.3rem 0; color:#555;">Current streak</td>
    <td>
      {% if streak and streak.current_streak_days %}
        <strong>{{ streak.current_streak_days }}</strong>
        day{{ 's' if streak.current_streak_days != 1 else '' }}
        {% if streak.last_active_date_utc %}
          &nbsp;<small>(last active: {{ streak.last_active_date_utc }})</small>
        {% endif %}
      {% else %}
        <span style="color:#888;">No streak yet</span>
      {% endif %}
    </td>
  </tr>
</table>

<h2>Recent attempts</h2>

{% if enriched_attempts %}
<table style="border-collapse:collapse; width:100%; max-width:700px;">
  <thead>
    <tr style="text-align:left; border-bottom:2px solid #ccc;">
      <th style="padding:0.4rem 1rem 0.4rem 0;">Content</th>
      <th style="padding:0.4rem 1rem 0.4rem 0;">Score</th>
      <th style="padding:0.4rem 1rem 0.4rem 0;">XP</th>
      <th style="padding:0.4rem 1rem 0.4rem 0;">Date (UTC)</th>
    </tr>
  </thead>
  <tbody>
    {% for item in enriched_attempts %}
    <tr style="border-bottom:1px solid #eee;">
      <td style="padding:0.4rem 1rem 0.4rem 0;">
        {% if item.content %}
          <a href="/content/{{ item.content.id }}/quiz">{{ item.content.title }}</a>
        {% else %}
          <span style="color:#888;">(deleted)</span>
        {% endif %}
      </td>
      <td style="padding:0.4rem 1rem 0.4rem 0;">
        {{ item.attempt.score_percent }}%
        <small style="color:#888;">({{ item.attempt.correct_count }}/{{ item.attempt.total_questions }})</small>
      </td>
      <td style="padding:0.4rem 1rem 0.4rem 0;">
        {% if item.attempt.xp_awarded > 0 %}
          <span style="color:green;">+{{ item.attempt.xp_awarded }}</span>
        {% else %}
          <span style="color:#888;">0</span>
        {% endif %}
      </td>
      <td style="padding:0.4rem 1rem 0.4rem 0; font-size:0.9em; color:#555;">
        {{ item.attempt.completed_at.strftime('%Y-%m-%d %H:%M') }}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
  <p id="no-attempts" style="color:#888;">No quiz attempts yet. <a href="/feed">Go to feed</a> to start learning!</p>
{% endif %}
{% endblock %}
